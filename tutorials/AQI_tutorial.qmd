---
title: "AQI tutorial"
filters: 
  - webr
  - naquiz

output: 
  html: 
    toc: true
    self-contained: false
---

Note to self, here's some options for downloading other cities data: 

r package https://cran.r-project.org/web/packages/RAQSAPI/vignettes/RAQSAPIvignette.html

This explains how to get json data and i did make an account https://aqs.epa.gov/aqsweb/documents/data_api.html#daily


<script>
console.log("Script loaded");
console.log("Button clicked");
document.addEventListener("DOMContentLoaded", function() {
    let currentPartIndex = 0;
    const parts = document.querySelectorAll(".tutorial-part");
    const buttons = document.querySelectorAll("button[id^='continue-button']");
    const headerHeight = document.querySelector("header") ? document.querySelector("header").offsetHeight : 0;
    const sidebarLinks = document.querySelectorAll("#quarto-margin-sidebar .sidebar a"); // Updated selector

 // Log the selected elements
    console.log('Tutorial parts:', parts);
    console.log('Continue buttons:', buttons);

    // Hide all tutorial parts except the first one
    parts.forEach(function(part, index) {
        if (index !== 0) {
            part.style.display = "none";}});
    
    // Function to scroll to the top of the element, accounting for a fixed header
      function scrollToElement(element) {
          const elementTop = element.getBoundingClientRect().top + window.scrollY;
          window.scrollTo({
              top: elementTop - headerHeight,
             behavior: "smooth"
         });
     }

    
    // Add click event listeners to each button
    buttons.forEach(function(button, index) {
        button.addEventListener("click", function() {
            if (currentPartIndex < parts.length - 1) {
                parts[currentPartIndex].style.display = "block";
                buttons[currentPartIndex].style.display = "none";
                currentPartIndex++;
                parts[currentPartIndex].style.display= "block";
                 // Jump to the id anchor for the current section
         //   window.location.hash = parts[currentPartIndex].id;
        // Scroll to the top of the current section
                scrollToElement(parts[currentPartIndex]);
             // Adjust scroll position to account for the height of the navbar
              //   window.scrollBy(0, 10000);
                } else {
                alert("End of tutorial");}});});});


  // Add click event listeners to sidebar links
  
 //    sidebarLinks.forEach((link, index) => {
//           link.addEventListener("click", function(event) {
//               event.preventDefault(); // Prevent default anchor behavior

            // Hide current part and button
            //parts[currentPartIndex].style.display = "none";
           // buttons[currentPartIndex].style.display = "none";

            // Move to the part corresponding to the sidebar link
 //           currentPartIndex = index;
 //           parts[currentPartIndex].style.display = "block";

            // Scroll to the current part
//            scrollToElement(parts[currentPartIndex]);
//        });
//      });
//    });

</script>

```{r}
#| include: false
library(tidyverse)
url<- "https://lewis-and-clark-data-science.github.io/6-12-Data-Science-Resources/files/data/Portland_2.5_2000-2023.csv"
download.file(url, "Portland_2.5_2000_2023.csv")
url<- "https://lewis-and-clark-data-science.github.io/6-12-Data-Science-Resources/files/data/LosAngeles_2.5_2000-2023.csv"
download.file(url, "LosAngeles_2.5_2000_2023.csv")
portland_AQI<- read_csv("Portland_2.5_2000_2023.csv")
la_AQI<- read_csv("LosAngeles_2.5_2000_2023.csv")

```

```{webr-r}
#| context: setup
library(tidyverse)
url<- "https://lewis-and-clark-data-science.github.io/6-12-Data-Science-Resources/files/data/Portland_2.5_2000-2023.csv"
download.file(url, "Portland_2.5_2000_2023.csv")
url<- "https://lewis-and-clark-data-science.github.io/6-12-Data-Science-Resources/files/data/LosAngeles_2.5_2000-2023.csv"
download.file(url, "LosAngeles_2.5_2000_2023.csv")
portland_AQI<- read.csv("Portland_2.5_2000_2023.csv")
la_AQI<- read.csv("LosAngeles_2.5_2000_2023.csv")

```


## Introduction

Welcome to this lesson on air quality! We'll be using **data science** to learn about **air quality**. This tutorial will introduce coding to help you better understand air quality. Advance through the tutorial by clicking the blue "Continue" buttons. By the end of the tutorial, you will be able to create your own graph of air quality! 

<div class="tutorial-part" style="display: block;">

First, let's learn about air quality. Check out this video to learn more about how air quality affects us. 

{{< video https://www.youtube.com/watch?v=zj4rd77EAt4 >}}

Click "Continue" to move to the next section. 

<button id="continue-button" class="btn btn-primary float-start me-2">Continue</button>
</div>

<div class="tutorial-part" style="display: none;">

## Data Science

What is data? 

-   Data is large amounts of information that you collect. Often, it looks like a lot of numbers that are collected to describe some phenomenon. 

-   For example, if you measure the temperature every day in one location for one year, you would have created **data**. You can then use **data science** to analyze that data. 

What is data science? 

-   Data science is the ability to synthesize **data** and derive meaningful information. Often, graphs, maps, models, and charts are used to help understand data and display information. 

**Stop and think** 

::: panel-tabset
## Question

::: question
**What is an example of data?**

::: choices
::: {.choice .correct-choice}
The age and grade of everyone in your school
:::

::: {.choice .correct-choice}
The favorite restaurant of everyone who walks down your street
:::

::: {.choice .correct-choice}
The pm2.5 data for every day in 2023 in Portland
:::

::: {.choice .correct-choice}
All of the above
:::
:::
:::
:::

<button id="continue-button" class="btn btn-primary float-start me-2">Continue</button>
</div>

<div class="tutorial-part" style="display: none;">


## Using the computer to do data science 

In this tutorial, we're going to use coding to analyze large amounts of data. We'll be able to create graphs by writing code. 

We're going to use a coding language called **R**. Basically, "R" is a collection of commands that the computer understands. You can tell the computer one of the commands and it will know to do something.

### Introduction to R

This tutorial lets you use R to work with data. Throughout the tutorial, there are gray boxes with a green "run code" button. These are called code chunks. You can type commands into these boxes and it will output answers. Let's try it out.

One command the computer knows is multiplication! Try typing `5*3` in the box right below this. Then **press** the green play button that says "run code".

::: panel-tabset

## Code editor

```{webr-r}
# Type your code here!


```

## Answer

**Press** run code

```{webr-r}
# Type your code here!
5*3

```
:::

Did you see the number 15 pop out?

Here's another code chunk you can try typing something into. Maybe you want to try a division problem? Or maybe you want the computer to say hello to you? There's a few different tabs you can click on to learn how to do cool things!

::: panel-tabset
## Code editor

Want to try out your own code? Maybe another math problem? Here's a place to do that. Otherwise click on the tabs to learn something new!

```{webr}
#Type your code here



```

## Say hello

Would you like the computer to say hello to you?

First, type your name where the blank \_\_\_\_\_\_\_ is, in the second code chunk. Don't delete the quotation marks.

Here's an example:

```{webr}
#| read-only: true
name = "Olivia"
```

Now your turn. Type your name instead of the blank \_\_\_\_\_ and then click play:

```{webr}
name = "_____"

cat("Hello", name, "How are you today?")

```

## Find the largest number

We can use r to find the largest number in a long list of numbers. To try this out, type a bunch of numbers inside the parentheses (\_\_\_\_\_\_). Separate your numbers with a comma. Don't delete anything else!

Here's an example:

```{webr-r}
#| read-only:true
numbers = c(41, 55, 98, 104, 2, 8)
```

Now you try. **Type** your numbers after the first parenthesis and separate them with a comma. Then **click** run code.

```{webr-r}
numbers = c(_,_,_,_,_,_,)
```

Now let's run a function that will tell us which number is the biggest. **Click** the play button on this code chunk too.

```{webr-r}
max(numbers)
```
:::

### Analyzing data with R

The programming language R can also do very complicated things, like work wiht large amounts of data and create graphs. 

-   You can import data from various sources,clean and process it, perform statistical analyses and generate reports or visualizations

-   We are going to be utilizing the data visualization aspect by creating graphs from a big data set

<button id="continue-button" class="btn btn-primary float-start me-2">Continue</button>
</div>

<div class="tutorial-part" style="display: none;">


## Our data

Today, we'll be looking at air quality data from the EPA. It contains data that was collected nearly every day for 23 years (2000-2023). Click the blue box below to view the data. **WHERE IS THE RAW DATA FROM**

::: {.callout-note collapse="true"}
## Air quality raw data Portland

```{r}
#| echo: false
#| output: true
library(knitr)
library(DT)
datatable(portland_AQI)
#kable(portland_AQI)

```
:::

::: {.callout-note collapse="true"}
## Air quality raw data Los Angelos

```{r}
#| echo: false
#| output: true
library(DT)
datatable(la_AQI)
```
:::

Wow that's a lot of data! It's pretty hard to get any meaningful information from just that table of information. Luckily, we can use R to better understand it and make graphs! 

Before we use R, though, let's try to understand a bit of what's going on. 

-   At the top of the table, there are bolded words. These are column titles and refer to the **variable names** that are collected when measuring air quality. 

-   Underneath the variable names, you'll see individual **entries** for the data. 

-   At the very bottom of the data table, you can click to different pages of data and see how many total entries there are.

**Stop and think**

::: panel-tabset

## Question

::: question 

*How many data entries are there in the Los Angeles data?* 

::: choices
::: {.choice .correct-choice}
8,594 data entries
:::
::: choice
8,744 data entries
:::
::: choice
10 data entries
:::
::: choice
100 data entries
:::
:::
:::
:::

### Data location

Let's find out where the air quality data was recorded. If you look at the data table, are you able to find all the **locations (sites) in Portland** where they recorded the air quality? 

-   This is a pretty hard task, as it requires you to look through all the data and find all the different site names. Luckily, we can use the computer to quickly check how many locations there are. 

-   The R command `unique()` outputs all the unique data entries in one column. In other words, it will tell us all the **different** entries the Site Name column. 

**Press** run code below. If you want to learn more about the code, click "Learn more"!

::: panel-tabset

## Code editor

```{webr-r}
unique(portland_AQI$Site.Name)
```

## Learn more

The command we used is 
```{r} 
#| eval: false
unique(portland_AQI$Site.Name)
```

-   `portland_AQI` specifies the data we're looking at. In this case, `portland_AQI` is the name of our data frame - it contains all the data in the Portland table you saw above.
      
      -   The name for the Los Angeles data is `la_AQI`. It contains all the data in the Los Angeles table you saw above.

-   The `$` tells R to find a column name. 

-   `Site.Name` is the name of the column we want to look at, as it contains the locations

## Challenge

Can you figure out the names of the Los Angeles locations where they measured air quality data? 

**Edit** the code below so that it outputs Los Angeles site names. 

*Hint:* You'll need to change the part of the code that says `portland_AQI`. What's the name of the Los Angeles data set? 

```{webr-r}
unique(portland_AQI$Site.Name)

```

## Challenge Answer

```{webr-r}
unique(la_AQI$Site.Name)

```
:::

Do you recognize any of the site names? Are any close to where you live?

## Graphing our data

Now that we understand **what** the data table contains, let's try to graph it and better understand what it **means**. 

to fix color situation, go to https://stackoverflow.com/questions/6919025/how-to-assign-colors-to-categorical-variables-in-ggplot2-that-have-stable-mappin


```{webr-r}
colnames(portland_AQI)[2] <- 'AQIVal'
colnames(la_AQI)[2] <- 'AQIVal'
colLabels <- c('Good', 'Moderate', 'Unhealthy','Unhealthy for Sensitive Groups', 'Very Unhealthy', 'Hazardous')
colScale <- scale_colour_manual(name = "colLabels",values = c('#238B44','#FFFF00', '#FFA500', '#E31A1C','#8F3F97', '#861130'))

portland_AQI |> 
  mutate(Date=mdy(Date))|>
  mutate(Year=year(Date),
          Month = month(Date),
         DOY = yday(Date))|> 
  mutate(AQI_Category = case_when(AQIVal >= 250.5 ~ 'Hazardous',
                                  AQIVal >= 150.5 ~ 'Very Unhealthy',
                                  AQIVal >= 55.5 ~ 'Unhealthy',
                                  AQIVal >= 35.5 ~ 'Unhealthy for Sensitive Groups',
                                  AQIVal >= 12.1 ~ 'Moderate',
                                  TRUE ~ 'Good'))|>
  mutate(AQI_Category = factor(AQI_Category, levels= colLabels)) |>
  
  ggplot(aes(x = DOY, y = Year, fill = AQI_Category))+
  geom_tile()+
  scale_y_reverse()+
  scale_discrete_manual('fill', values = c('#238B44','#FFFF00', '#FFA500', '#E31A1C','#8F3F97', '#861130'))



la_AQI |> 
  mutate(Date=mdy(Date))|>
  mutate(Year=year(Date),
          Month = month(Date),
         DOY = yday(Date))|> 
  mutate(AQI_Category = case_when(AQIVal >= 250.5 ~ 'Hazardous',
                                  AQIVal >= 150.5 ~ 'Very Unhealthy',
                                  AQIVal >= 55.5 ~ 'Unhealthy',
                                  AQIVal >= 35.5 ~ 'Unhealthy for Sensitive Groups',
                                  AQIVal >= 12.1 ~ 'Moderate',
                                  TRUE ~ 'Good'))|>
  mutate(AQI_Category = factor(AQI_Category, levels= colLabels)) |>
  
  ggplot(aes(x = DOY, y = Year, fill = AQI_Category))+
  geom_tile()+
  scale_y_reverse()+
  colScale




```